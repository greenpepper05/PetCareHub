<div class="min-h-full">

    <div class="bg-[var(--secondary)] text-white p-6 rounded-xl shadow-lg mb-6">
        <div class="flex items-center text-sm mb-2 opacity-80">
            <mat-icon class="mr-1 text-base">receipt_long</mat-icon>
            <span>Service Detail</span>
        </div>
        
        <div class="flex justify-between items-center">
            <h1 class="text-3xl font-bold">
                Record #{{ services?.id }}
            </h1>
            
            <button 
                routerLink="/admin/service-record" 
                class="flex items-center border-white text-white hover:bg-white hover:text-[var(--primary)] transition-colors py-2 px-4 rounded-lg"
            >
                <mat-icon class="mr-1 text-base">arrow_back</mat-icon> Back to Records
            </button>
        </div>
    </div>

    <div class="space-y-6"> 
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2 flex items-center">
                    <mat-icon class="text-2xl mr-2 text-indigo-600">pets</mat-icon> Pet Information
                </h3>
                <div class="space-y-3 text-sm">
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Pet ID:</span><strong class="text-gray-900">{{ pet?.id }}</strong></p>
                    <p class="flex justify-between border-b pb-1">
                        <span class="font-medium text-gray-500">Name:</span>
                        <strong routerLink="/admin/pets/{{ pet?.id }}" class="text-indigo-600 hover:underline cursor-pointer">{{ pet?.name }}</strong>
                    </p>
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Birthday:</span><strong class="text-gray-900">{{ pet?.birthdate | date:'mediumDate' }}</strong></p>
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Breed:</span><strong class="text-gray-900">{{ pet?.breed }}</strong></p>
                    <p class="flex justify-between"><span class="font-medium text-gray-500">Species:</span><strong class="text-gray-900">{{ pet?.species }}</strong></p>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2 flex items-center">
                    <mat-icon class="text-2xl mr-2 text-green-600">person</mat-icon> Owner Information
                </h3>
                <div class="space-y-3 text-sm">
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">First Name:</span><strong class="text-gray-900">{{ owner?.firstName }}</strong></p>
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Last Name:</span><strong class="text-gray-900">{{ owner?.lastName }}</strong></p>
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Contact Number:</span><strong class="text-gray-900">{{ owner?.contact}}</strong></p>
                    <p class="flex justify-between"><span class="font-medium text-gray-500">Email:</span><strong class="text-gray-900">{{ owner?.email }}</strong></p>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6">
                <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2 flex items-center">
                    <mat-icon class="text-2xl mr-2 text-amber-600">medical_services</mat-icon> Service Details
                </h3>
                <div class="space-y-3 text-sm">
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Service Name:</span><strong class="text-gray-900">{{ services?.serviceName }}</strong></p>
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Date of Service:</span><strong class="text-gray-900">{{ services?.dateOfService | date: 'fullDate' }}</strong></p>
                    
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Visit Type:</span>
                        <span class="text-gray-900 inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                            [ngClass]="{'bg-purple-100 text-purple-800': services?.visitType === 'Appointment', 'bg-blue-100 text-blue-800': services?.visitType !== 'Appointment'}">
                            @if (services?.visitType === 'Appointment') {
                                {{ services?.visitType }} : # {{ services?.appointmentId }}
                            } @else {
                                {{ services?.visitType }}
                            }
                        </span>
                    </p>
                    
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Status:</span>
                         <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold"
                            [ngClass]="{
                                'bg-green-100 text-green-800': services?.status === 'Completed', 
                                'bg-yellow-100 text-yellow-800': services?.status === 'Pending',
                                'bg-red-100 text-red-800': services?.status === 'Cancelled'
                            }">
                            {{ services?.status}}
                        </span>
                    </p>
                    <p class="flex justify-between border-b pb-1"><span class="font-medium text-gray-500">Price:</span><strong class="text-gray-900">{{ services?.price | currency:"PHP" }}</strong></p>
                    <p class="pt-2"><span class="font-medium text-gray-500 block mb-1">Notes:</span><strong class="block bg-gray-50 p-3 rounded-lg text-gray-800 whitespace-pre-wrap">{{ services?.notes ? services?.notes : 'No notes recorded for this service.'}}</strong></p>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 flex flex-col">
                <h3 class="text-xl font-semibold mb-4 text-gray-800 border-b pb-2 flex items-center">
                    <mat-icon class="text-2xl mr-2 text-red-600">list_alt</mat-icon> Procedure Steps
                </h3>
                
                <div class="overflow-x-auto flex-grow mb-4">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/12">
                                    #
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8/12">
                                    Description
                                </th>
                                <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-3/12">
                                    Status
                                </th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            @for(procedure of procedures; track procedure.id) {
                                <tr>
                                    <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                                        {{ procedure.order + 1 }}
                                    </td>
                                    <td class="px-6 py-3 whitespace-normal text-sm text-gray-800">
                                        {{ procedure.name }}
                                    </td>
                                    <td class="px-6 py-3 whitespace-nowrap text-center text-sm">
                                        @if (services?.status !== 'Completed') {
                                            <input 
                                                type="checkbox" 
                                                class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                                                [checked]="!procedure.isSkipped" 
                                                (change)="onSkipChange(procedure, $event)">
                                        }

                                        @if (services?.status === 'Completed' || services?.status === 'In Progress') {
                                            <span [ngClass]="{'text-red-500 font-semibold': procedure.isSkipped, 'text-green-600 font-semibold': !procedure.isSkipped && services?.status === 'Completed', 'text-yellow-600': !procedure.isSkipped && services?.status === 'In Progress'}">
                                                @if (procedure.isSkipped) {
                                                    Skipped 
                                                } @else if (services?.status === 'Completed') {
                                                    Done
                                                } @else {
                                                    In Progress
                                                }
                                            </span>
                                        } @else if (services?.status !== 'Completed') {
                                            <span [ngClass]="{'text-red-500': procedure.isSkipped, 'text-gray-500': !procedure.isSkipped}">
                                                {{ procedure.isSkipped ? 'Skipped' : 'Pending' }}
                                            </span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                
                <div class="mt-4 flex justify-end gap-3 border-t pt-4">
                    <button 
                        mat-flat-button
                        (click)="services?.status === 'Completed' 
                                        ? viewProcedure() 
                                        : openStaffSelection()"
                            class="bg-[var(--primary)] hover:bg-[var(--secondary)] text-white font-bold py-2 px-4 rounded-lg shadow-md"
                    >
                        <mat-icon class="mr-1">
                            {{ services?.status === 'Completed' ? 'visibility' : 'play_arrow' }}
                        </mat-icon>

                        {{ services?.status === 'Completed' ? 'View Procedure' : 'Start Procedure' }}
                    </button>


                    <button 
                        mat-stroked-button 
                        (click)="deleteRecord(services?.id)"
                        class="border-red-500 text-red-500 hover:bg-red-50"
                    >
                        <mat-icon class="mr-1">delete</mat-icon>
                        Delete Record
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>