<div class="flex flex-col h-screen overflow-hidden custom-font">
      
      @if (busyService.loading) {
        <mat-progress-bar mode="indeterminate" class="absolute top-0 left-0 w-full z-50"></mat-progress-bar>
        }

      <!-- 1. TOP HEADER BAR -->
      <header class="h-16 bg-[var(--white)] shadow-lg flex items-center justify-between px-4 fixed top-0 left-0 w-full z-20">
          <div class="flex items-center">
              <!-- Mobile Menu Toggle Button (Visible only on mobile) -->
              <button class="menu-button" (click)="toggleSidebarCollapse()" [attr.aria-label]="isMobile() ? 'Open mobile menu' : 'Toggle sidebar'">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
              </button>

              <!-- SUPER ADMIN NAME -->
              <h1 class="text-xl font-extrabold text-[var(--primary)] ml-2">
                {{ systemName }}
              </h1>
          </div>

          <div class="relative">
            <div class="flex items-center gap-2 cursor-pointer p-2 rounded-xl hover:bg-gray-100 transition-colors" (click)="toggleDropdown()">
                
                <!-- Profile Picture (Mock Data) -->
                <img [src]="pictureUrl" alt="clinic logo" class="rounded-full w-10 h-10 object-cover border-2 border-gray-200">
                
                <!-- User Info (Mock Data) -->
                <div class="hidden sm:block text-right">
                    <p class="font-semibold text-sm">{{ adminDisplayName() }}</p>
                    <p class="text-xs text-gray-500">{{ superAdmin.role }}</p>
                </div>
                
                <!-- Dropdown Icon -->
                <mat-icon class="text-gray-500 text-base transition-transform duration-300" 
                          [class.rotate-180]="isDropdownOpen()">keyboard_arrow_down</mat-icon>
            </div>
            
            <!-- Dropdown Menu -->
            @if(isDropdownOpen()) {
                <div (click)="$event.stopPropagation()" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl py-1 z-30 border border-gray-200 animate-fadeInUp">
                
                    <!-- User Details in Menu (Optional) -->
                    <div class="px-4 py-2 text-sm text-gray-700 border-b border-gray-100 mb-1">
                        <p class="font-medium">{{ adminDisplayName() }}</p>
                        <p class="text-xs text-gray-500">{{ superAdmin.role }}</p>
                    </div>

                    <!-- Divider -->
                    <hr class="my-1 border-gray-100">

                    <!-- Logout Option -->
                    <button (click)="logout()"
                            class="w-full text-left flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 hover:text-red-700 transition-colors">
                        <mat-icon class="!w-5 !h-5 mr-3 text-red-500">logout</mat-icon>
                        Logout
                    </button>
                </div>
            }
            
        </div>
      </header>

      <!-- 2. MAIN CONTENT AREA (Sidebar + Content) -->
      <div class="flex flex-1 mt-16 overflow-hidden">
          
          <!-- Mobile Sidebar (Uses mat-sidenav for overlay, here mocked as a simple overlay div) -->
          @if (isMobile() && isSidenavOpen()) {
              <!-- Backdrop -->
              <div (click)="toggleMobileSidenav()" class="fixed inset-0 bg-gray-50 z-30"></div>
              
              <!-- Sidenav Content -->
              <div class="fixed top-0 left-0 h-full bg-[var(--primary)] p-0 z-40 transition-transform duration-300 ease-in-out w-64">
                  <div class="flex flex-col justify-between h-full text-[var(--white)] p-4">
                      <div class="space-y-2">
                          <div class="flex justify-between items-center mb-6">
                              <h1 class="text-xl font-bold">Petcarehub Central</h1>
                              <button class="text-[var(--white)]" (click)="toggleMobileSidenav()" aria-label="Close mobile menu">
                                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                              </button>
                          </div>
                          
                          <!-- Mobile Navigation Links -->
                          @for (link of navigationLinks; track link.route) {
                            <a [href]="link.route" (click)="toggleMobileSidenav()"
                                class="flex items-center gap-4 p-3 rounded-xl transition-colors duration-200 w-full hover:bg-[var(--secondary)]">
                                <span class="material-icons">{{ link.icon }}</span>
                                <h1 class="text-lg">{{ link.title }}</h1>
                            </a>
                          }
                          
                      </div>
                  </div>
              </div>
          } 
          
          <!-- Desktop Sidebar (Fixed and Collapsible) -->
          @if (!isMobile()) {
              <!-- Sidebar Container (The primary color bar) -->
              <aside 
                  [ngClass]="isSidebarCollapsed() ? collapsedWidth : expandedWidth" 
                  class="flex flex-col justify-between bg-[var(--primary)] text-[var(--white)] shadow-2xl transition-all duration-300 ease-in-out h-full flex-shrink-0 relative z-10"
              >
                  <div class="p-2"> 
                      <div>
                          <!-- Logo/System Name - Only show text when expanded -->
                          @if (!isSidebarCollapsed()) {
                              <div class="py-2 px-3 mb-4">
                                  <h1 class="text-xl font-bold">Petcarehub Central</h1>
                              </div>
                          }

                          <!-- Navigation Links -->
                          <div class="bg-transparent space-y-2">
                              @for (link of navigationLinks; track link.route) {
                                <!-- Link Item -->
                                <div class="p-0 h-auto">
                                  <a routerLink="{{ link.route }}" 
                                      [class.active-link]="link.route === '/super-admin/dashboard'"
                                      class="flex items-center p-3 rounded-xl transition-colors duration-200 w-full hover:bg-[var(--secondary)]"
                                      [class.justify-center]="isSidebarCollapsed()" Â 
                                      [class.gap-4]="!isSidebarCollapsed()"
                                      [title]="isSidebarCollapsed() ? link.title : ''"
                                  >
                                      <span class="material-icons">{{ link.icon }}</span>
                                      @if (!isSidebarCollapsed()) {
                                          <h1 class="text-lg whitespace-nowrap">{{ link.title }}</h1>
                                      }
                                  </a>
                                </div>
                              }
                          </div>
                      </div>
                  </div>
              </aside>
          }

          <!-- MAIN CONTENT AREA -->
          <main 
              class="flex-1 overflow-y-auto p-8 bg-gray-50 transition-all duration-300 ease-in-out"
              [ngClass]="isMobile() ? 'w-full' : ''"
          >
              <router-outlet></router-outlet>
          </main>
      </div>
    </div>